---
layout: detail
title: Js中异步与EventLoop机制
tag: 技术
date: "2020-09-01"
---

### 什么是同步与异步

同步就是做完一件事儿后，就知道结果。

异步是干完一件事儿，念念不忘，必有回响。

以代码为例

```js
//同步
const test = () => {
  const s = +new Date();
  while (true) {
    if (+new Date() - s >= 2000) {
      break;
    }
  }
};
console.log("1");
test(); //同步，等执行完再下一步
console.log("2");

//最终先打印'1'等2秒后再打印'2',同步情况下，你得等别人完事儿了，才能轮到你
```

```js
//异步
console.log("1");
setTimeout(() => {
  console.log("exec");
}, 2000); //这里会执行，但是不等
console.log("2");
//最终先打印'1'>>'2'>>2s后打印'exec'
```

实际上，我们碰到的异步场景不只是定时器，同步异步任务执行的顺序是 JS 执行环境 EventLoop 决定的

### 浏览器端的 Event Loop

```js
// 上代码
console.log("1");
setTimeout(() => {
  console.log("2");
}, 0);
Promise.resolve().then(() => {
  console.log("3");
});
console.log("4");

//结果是 1>>4>>3>>2
```

按照之前同步的思路，不应该是 setTimeout 先嘛，为啥反而是 Promise 先执行，难道你 Promise 姓赵。

同样是异步，但是大家的层级还真不一样

### NodeJs 的 Event Loop
NodeJs以非阻塞的IO单线程,其核心在于Libuv
